<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../assets/css/product.css" rel="stylesheet"> 
    <title>Hello, world!</title>
  </head>
  <body class="bg-light">
    <div class="container mt-5 mb-5">
      <div class="card">
          <div class="row g-0">
              <div class="col-md-6 border-end">
                  <div class="d-flex flex-column justify-content-center">
                      <div class="main_image"> <img src="#" id="main_product_image" class="img0" width="350"> </div>
                      <div class="thumbnail_images">
                          <ul id="thumbnail">
                              <li class="d-none"><img onclick="changeImage(this)" src="#" width="70" class="img0"></li>
                              <li class="d-none"><img onclick="changeImage(this)" src="#" width="70" class="img1"></li>
                              <li class="d-none"><img onclick="changeImage(this)" src="#" width="70" class="img2"></li>
                              <li class="d-none"><img onclick="changeImage(this)" src="#" width="70" class="img3"></li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="p-3 right-side">
                      <div class="d-flex justify-content-between align-items-center">
                          <h3 class="lblName">Beautiful sofa</h3> <span class="heart"><i class='bx bx-heart'></i></span>
                      </div>
                      <div class="mt-2 pr-3 content">
                          <p class="lblDescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</p>
                      </div>

                      <div class="row">
                            <div class="col-12 mb-3 dvSizes d-none">
                                <label class="form-label">Sizes</label><br>
                                <div class="form-check form-check-inline d-none chSizes">
                                    <input class="form-check-input chk" type="radio" name="chsizes" value="0">
                                    <label class="form-check-label lbl">Small</label>
                                </div>
                            </div>
                            <div class="col-12 mb-3 dvColors d-none">
                                <label class="form-label">Colors</label><br>
                                <div class="form-check form-check-inline d-none chColors">
                                    <input class="form-check-input chk" type="radio"  name="chcolors" value="0">
                                    <label class="form-check-label lbl">Small</label>
                                </div>
                            </div>
                        </div>

                      <h3 class="lblPrice">$430.99</h3>
                      <div class="buttons d-flex flex-row mt-5 gap-3"> <button class="btn btn-outline-dark btnAddtocart">Add To Cart</button></div>
                </div>
              </div>
          </div>
      </div>
  </div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script>
        var formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2
        });

        $(document).ready(function(){
            let queryString = window.location.search,
                urlParams = new URLSearchParams(queryString),
                productId = urlParams.get('pid');

            getProduct(productId);

            $(".btnAddtocart").click(function(){
                let currentItem = $(this).data("item"),
                    newItem = {},
                    currentCart = JSON.parse(localStorage.getItem("currentCart")),
                    config = JSON.parse(currentItem.dimensions),
                    size = null,
                    color = null,
                    newItemId = currentItem.id;

                if(!currentCart){
                    localStorage.setItem("currentCart", "{}");
                    currentCart = {};
                }

                if(config !=  "0"){
                    if((config[0].sizes).length > 0){
                        size = $("input[type=radio][name=chsizes]:checked").val();
                        newItemId += `|s-${size}`;
                        newItem.size = size;
                    }

                    if(config[1].colors[0] != ""){
                        color = $("input[type=radio][name=chcolors]:checked").val();
                        newItemId += `|c-${color}`;
                        newItem.color = color;
                    }
                }

                newItem.id = currentItem.id;
                newItem.name = currentItem.name;
                newItem.descriptions = currentItem.descriptions;
                newItem.thumbnail = currentItem.thumbnail;

                if( (currentItem.sale_price).length > 0 && currentItem.sale_price > 0){
                    newItem.price = currentItem.sale_price;
                }else{
                    newItem.price = currentItem.price;
                }

                if(currentCart[newItemId]){
                    currentCart[newItemId].qty = currentCart[newItemId].qty + 1;
                }else{
                    newItem.qty = 1;
                    currentCart[newItemId] = newItem;
                }

                localStorage.setItem("currentCart", JSON.stringify(currentCart));
                alert("Product added to your shopping cart");
            });
        });

        function changeImage(element) {
            var main_prodcut_image = document.getElementById('main_product_image');
            main_prodcut_image.src = element.src;
        }

        function getProduct(productId){
            let objData = {
                "_method":"getProductId",
                "productId": productId
            };

            $.post("../core/controllers/product.php", objData, function(result){
                if(result.data){
                    let info = result.data[0],
                        config = JSON.parse(info.dimensions);

                    $(".lblName").html(info.name);
                    $(".lblDescription").html(info.descriptions);

                    if( (info.sale_price).length > 0 && info.sale_price > 0){
                        $(".lblPrice").html( formatter.format(info.sale_price) );
                    }else{
                        $(".lblPrice").html( formatter.format(info.price) );
                    }

                    $(".btnAddtocart").data("item", info);

                    let images = JSON.parse(info.images);
                    if(images){
                        $.each( images, function( index, item){
                            $(`.img${index}`)
                                .attr("src", `../${item}`)
                                .parent().removeClass("d-none");
                        });
                    }else{
                        $(`.img0`)
                            .attr("src", `https://www.newneuromarketing.com/media/zoo/images/NNM-2015-019-Cost-consciousness-increase-product-sales-with-Price-Primacy_6a73d15598e2d828b0e141642ebb5de3.png`)
                            .parent().removeClass("d-none");
                    }

                    document.title = `${info.name} Pages`;

                    if( config!="0" || (config[0].sizes).length != 0 || config[1].colors[0] != "" ){
                        $(".dvSizes").addClass("d-none");
                        if((config[0].sizes).length > 0){
                            $(".dvSizes").removeClass("d-none");
                            $(".toRemoves").remove();

                            $.each(config[0].sizes, function(index, item){
                                let dv = $(".chSizes").clone();

                                dv.find(".chk").val(item).attr("id", `ch${item}`);

                                if(item == "sm")
                                    dv.find(".lbl").html("Small");

                                if(item == "m")
                                    dv.find(".lbl").html("Medium");

                                if(item == "l")
                                    dv.find(".lbl").html("Large");

                                if(item == "xl")
                                    dv.find(".lbl").html("Extra large");

                                dv.find(".lbl").attr("for", `ch${item}`);
                                
                                if(index == 0)
                                    dv.find(".chk").prop("checked", true);

                                dv.removeClass("d-none chSizes");
                                dv.addClass("toRemoves");
                                $(dv).appendTo(".dvSizes");
                            });
                        }

                        $(".dvColors").addClass("d-none");
                        if(config[1].colors[0] != ""){
                            $(".dvColors").removeClass("d-none");
                            $(".toRemovec").remove();

                            let items = (config[1].colors[0]).split(",");
                            $.each(items, function(index, item){
                                let dv = $(".chColors").clone();

                                dv.find(".chk").val(item).attr("id", `rd${item}`);
                                dv.find(".lbl").html(item).attr("for", `rd${item}`);

                                if(index == 0)
                                    dv.find(".chk").prop("checked", true);

                                dv.removeClass("d-none chColors");
                                dv.addClass("toRemovec");
                                $(dv).appendTo(".dvColors");

                            });
                        }
                    }
                }
            });
        }
  </script>
</body>
</html>
